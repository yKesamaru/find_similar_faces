# 【faiss】なにこれすごい！顔データセットの間違い探し　成功編③

 23%|███████████████████████████████▉                                                                                                              | 187589/832695 [11:18<48:42, 220.73it/s]


24時間計算させて100日以上かかる計算のため、多次元ベクトルの類似度計算の組み合わせをfaiss-GPUで行います。
組み合わせ総数は1,586,098,692通りです。15億8600通り！
faiss-GPUを使用することで、すべての組み合わせの類似度計算を、9秒で完了させることができました。
![](https://raw.githubusercontent.com/yKesamaru/find_similar_faces/master/assets/%E9%A1%94%E3%83%87%E3%83%BC%E3%82%BF%E3%82%BB%E3%83%83%E3%83%88%E3%81%AE%E9%96%93%E9%81%95%E3%81%84%E6%8E%A2%E3%81%97_4.png)

今回は、以下の記事の続きです。
https://zenn.dev/ykesamaru/articles/d4b78ea53b02e2
https://zenn.dev/ykesamaru/articles/83b171b045809c

## はじめに
> 深層学習におけるモデル学習において、データセットのクレンジングは重要な作業です。
> 顔認証システムにおいてのデータセットのクレンジングとは、「人物Aの顔画像ファイルが、間違いなく人物Aのフォルダーに存在しているか」と定義できます。
> このクレンジング作業は、ある程度自動化していますが、最終的には目視で確認する必要があります。
> なかには知っている人物もありますが、大部分は知らない人物です。
> スクレイピング対象の人物名がマイナーな場合（仮に人物Aとします）、同じ名字の有名人（人物B）がヒットしてしまうこともあります。
> 有名人と言っても私は知らないので、顔画像枚数の多い人物Bを、人物Aのフォルダーに配置してしまうかもしれません。
> 人物Aのフォルダーには人物Aの顔画像ファイルが存在し、人物Bのフォルダーにも人物Aの顔画像ファイルが存在することになってしまいます。
> この状態は、モデル学習において、大きな悪影響を及ぼします。
> 
> そこで既存の顔学習モデルを使用して、各フォルダーの顔画像ファイルと、他のフォルダーに存在する顔画像ファイルとのコサイン類似度を計算し、類似度が高いものを抽出します。

ここまでが、これまでの記事の共通な内容です。
そして、これまでいくつかの方法で計算を行い、現実的な時間での処理ができないでいました。

今回は、多次元ベクトルの類似度計算の組み合わせをfaiss-GPUで行います。

## faissコード
```python

```


 23%|████████████████████████████████▌                                                                                                             | 191296/832695 [11:45<51:05, 209.22it/s]

WARNING clustering 22 points to 10 centroids: please provide at least 390 training points

 33%|███████████████████████████████████████████████▍                                                                                              | 278156/832695 [15:24<37:54, 243.78it/s
処理時間: 1分 26.97秒

処理時間: 0分 8.98秒